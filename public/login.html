<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Login • UNHINGED</title>
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <main class="wrap">
    <div class="card">
      <h1>Welcome back</h1>

      <label for="email">Email</label>
      <input type="email" id="email" placeholder="you@email.com" required>

      <label for="password">Password</label>
      <input type="password" id="password" placeholder="Password" required minlength="6">

      <div class="row">
        <button class="btn-primary" id="signin" type="button">Sign In</button>
        <button class="btn-ghost" id="create" type="button">Create account</button>
        <button class="btn-ghost" id="forgot" type="button">Forgot?</button>
      </div>

      <p id="status"></p>
    </div>
  </main>

  <!-- IMPORTANT: Firebase first, then auth.js -->
  <script type="module" src="./js/firebase.js"></script>
  <script type="module">
    import {
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword,
      sendPasswordResetEmail
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { auth } from "./js/firebase.js";

    const emailEl  = document.getElementById('email');
    const passEl   = document.getElementById('password');
    const statusEl = document.getElementById('status');

    const signinBtn = document.getElementById('signin');
    const createBtn = document.getElementById('create');
    const forgotBtn = document.getElementById('forgot');

    function msg(t, ok=false){
      if(!statusEl) return;
      statusEl.textContent = t || '';
      statusEl.className = ok ? 'ok' : 'warn';
    }

    async function doSignIn(){
      try{
        msg('Signing in…');
        const em = (emailEl?.value || '').trim();
        const pw = passEl?.value || '';
        await signInWithEmailAndPassword(auth, em, pw);
        msg('Signed in!', true);
        location.replace('./index.html'); // go to main app
      }catch(err){
        msg(err?.message || String(err));
      }
    }

    async function doCreate(){
      try{
        msg('Creating account…');
        const em = (emailEl?.value || '').trim();
        const pw = passEl?.value || '';
        await createUserWithEmailAndPassword(auth, em, pw);
        msg('Account created!', true);
        location.replace('./index.html'); // go to main app
      }catch(err){
        msg(err?.message || String(err));
      }
    }

    async function doForgot(){
      try{
        const em = (emailEl?.value || '').trim();
        if(!em){ msg('Enter your email first'); return; }
        await sendPasswordResetEmail(auth, em);
        msg('Reset email sent', true);
      }catch(err){
        msg(err?.message || String(err));
      }
    }

    signinBtn?.addEventListener('click', doSignIn);
    createBtn?.addEventListener('click', doCreate);
    forgotBtn?.addEventListener('click', doForgot);
  </script>
</body>
</html>
