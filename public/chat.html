<!DOCTYPE html><html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>UNHINGED ‚Äî Chat</title>
<style>
  :root{--red:#E11D2A}
  *{box-sizing:border-box} body{margin:0;background:#0f0f12;color:#fff;font:500 16px/1.5 Inter,system-ui}
  a{color:#fff;text-decoration:none}
  .wrap{max-width:1100px;margin:0 auto;padding:18px}
  .top{display:flex;gap:10px;align-items:center;margin-bottom:12px}
  .pill{padding:8px 12px;background:#1a1b22;border:1px solid rgba(255,255,255,.08);border-radius:999px}
  h1{margin:6px 0 2px;font-size:26px;font-weight:900}
  .sub{color:#cfd0de}
  select,input,button{background:#12131a;border:1px solid #2a2a2a;color:#fff;border-radius:10px;padding:10px}
  button{cursor:pointer;font-weight:800}
  .card{background:#15161b;border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:12px}
  .msgs{height:56vh;overflow:auto;border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:10px;background:#0e0f14}
  .msg{margin:8px 0}
  .me{color:#8ff79d} .other{color:#e3e3ea} .sys{color:#9aa0aa;font-size:13px}
  .meta{font-size:12px;color:#9aa0aa}
  .row{display:flex;gap:10px;flex-wrap:wrap;margin:12px 0}
  .inputbar{display:flex;gap:8px;margin-top:10px}
  .inputbar input{flex:1}
</style>
</head><body>
<div class="wrap">
  <div class="top">
    <a class="pill" href="index.html">‚Üê Home</a>
    <a class="pill" href="badges.html">üèÖ Badges</a>
    <a class="pill" href="redflags.html">üö© Red Flags</a>
  </div>

  <h1>Community Chat</h1>
  <div class="sub">Meet people, talk chaos. (Demo mode ‚Äî works across tabs on this device.)</div>

  <div class="row">
    <select id="room">
      <option value="lobby">#lobby</option>
      <option value="dating">#dating</option>
      <option value="friends">#friends</option>
      <option value="fwb">#friends-with-benefits</option>
      <option value="vents">#vents</option>
    </select>
    <input id="handle" placeholder="Your name (real names preferred)">
    <button id="enter" style="background:var(--red);border:0">Enter</button>
  </div>

  <div class="card">
    <div id="status" class="sys">Pick a room and enter.</div>
    <div id="feed" class="msgs"></div>
    <div class="inputbar">
      <input id="text" placeholder="Type a message‚Ä¶" disabled>
      <button id="send" disabled>Send</button>
    </div>
  </div>
</div>

<script>
/* Single-file demo chat: localStorage + BroadcastChannel */
const roomSel = document.getElementById('room');
const handle  = document.getElementById('handle');
const enter   = document.getElementById('enter');
const status  = document.getElementById('status');
const feed    = document.getElementById('feed');
const text    = document.getElementById('text');
const sendBtn = document.getElementById('send');

let room = roomSel.value || 'lobby';
let name = '';
const chan = ('BroadcastChannel' in window) ? new BroadcastChannel('unhinged_chat') : null;

function key(r){ return `uh_chat_${r}`; }
function load(r){ try{return JSON.parse(localStorage.getItem(key(r))||'[]')}catch{return []} }
function save(r,arr){ try{localStorage.setItem(key(r), JSON.stringify(arr))}catch{} }
function timeFmt(ts){ return new Date(ts).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}); }

function renderRoom(r){
  feed.innerHTML = '';
  load(r).slice(-200).forEach(m=>{
    const mine = m.user===name;
    const div = document.createElement('div');
    div.className = 'msg';
    div.innerHTML = `
      <div class="${mine?'me':'other'}"><strong>${m.user}</strong> ‚Äî ${m.text}</div>
      <div class="meta">${timeFmt(m.ts)}</div>
    `;
    feed.appendChild(div);
  });
  feed.scrollTop = feed.scrollHeight;
}

function postLocal(textVal){
  const msg = { user:name, text:textVal.slice(0,500), ts:Date.now(), room };
  const arr = load(room); arr.push(msg); save(room, arr);
  renderRoom(room);
  if (chan) chan.postMessage({ type:'new', room });
}

enter.addEventListener('click', ()=>{
  name = (handle.value||'').trim();
  if(!name){ alert('Enter your name.'); return; }
  status.textContent = `Connected as ${name}`;
  text.disabled = false; sendBtn.disabled = false;
  renderRoom(roomSel.value);
});

roomSel.addEventListener('change', e=>{
  room = e.target.value;
  if(!name) return;
  renderRoom(room);
});

sendBtn.addEventListener('click', ()=>{
  const v = text.value.trim(); if(!v) return;
  text.value = ''; postLocal(v);
});
text.addEventListener('keydown', e=>{ if(e.key==='Enter') sendBtn.click(); });

if (chan) chan.onmessage = evt=>{
  if (evt.data?.type==='new' && evt.data.room===room) renderRoom(room);
};
</script>
</body></html>
